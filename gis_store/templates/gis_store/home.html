<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebGIS - Circle K & GS25 c·ªßa B√© Thu·∫≠n</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      --red:#e31c23; --red2:#c3141a; --yellow:#ffd100;
      --bg:#f6f7fb; --card:#fff; --border:#e5e7eb;
      --ink:#111827; --muted:#6b7280;
      --shadow:0 10px 26px rgba(0,0,0,.10);
      --container:1200px;
      --r:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink)}
    a{text-decoration:none;color:inherit}
    .wrap{max-width:var(--container);margin:0 auto;padding:0 14px}

    /* top mini nav (gi·ªëng CircleK c√≥ d√≤ng menu nh·ªè) */
    .top-mini{
      background:#fff;
      border-bottom:1px solid var(--border);
      font-size:13px;
    }
    .top-mini .wrap{
      display:flex;justify-content:flex-end;gap:18px;align-items:center;
      padding:10px 14px;
      color:#111827;
    }
    .top-mini a{color:#111827;opacity:.9}
    .top-mini a:hover{opacity:1}

    /* header ƒë·ªè + menu */
    .header{
      background:linear-gradient(180deg,var(--red),var(--red2));
      color:#fff;
      box-shadow:var(--shadow);
      position:sticky; top:0; z-index:10;
    }
    .header .wrap{
      display:flex;align-items:center;gap:16px;
      padding:12px 14px;
    }
    .logo{
      display:flex;align-items:center;gap:12px;
      min-width:250px;
    }
    .logo-box{
      width:140px;height:46px;background:#fff;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      font-weight:1000;color:var(--red);letter-spacing:1px;
    }
    .menu{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      flex:1;
    }
    .tab{
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.22);
      color:#fff;
      padding:12px 14px;
      border-radius:12px;
      cursor:pointer;
      display:inline-flex;gap:10px;align-items:center;
      font-weight:900;
      user-select:none;
    }
    .tab.active{
      background:#fff;color:var(--red);
      border-color:transparent;
    }

    /* hero gi·ªëng ‚ÄúT√åM C·ª¨A H√ÄNG‚Ä¶‚Äù */
    .hero{
      background:linear-gradient(180deg,#ffb25c,#f58a27);
      color:#fff;
      margin:14px 0;
      border-radius:22px;
      overflow:hidden;
      box-shadow:var(--shadow);
    }
    .hero .wrap{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      padding:18px 18px;
      align-items:center;
    }
    .hero h1{margin:0;font-size:38px;letter-spacing:.5px}
    .hero p{margin:10px 0 0 0;opacity:.95;line-height:1.5}
    .hero-card{
      background:rgba(255,255,255,.15);
      border:1px solid rgba(255,255,255,.22);
      border-radius:18px;
      padding:14px;
    }

    /* search bar */
    .search{
      background:#fff;
      border:1px solid rgba(255,255,255,.0);
      border-radius:999px;
      padding:10px 12px;
      display:flex;gap:10px;align-items:center;
      box-shadow:0 12px 24px rgba(0,0,0,.18);
    }
    .pin{
      width:34px;height:34px;border-radius:999px;
      display:grid;place-items:center;
      background:rgba(255,209,0,.22);
      border:1px solid rgba(255,209,0,.45);
    }
    .search input{
      width:100%;
      border:none;outline:none;
      font-size:14px;
    }
    .btn{
      border:none;cursor:pointer;
      border-radius:12px;
      padding:10px 12px;
      font-weight:1000;
      display:inline-flex;gap:8px;align-items:center;
      white-space:nowrap;
    }
    .btn-yellow{background:linear-gradient(180deg,var(--yellow),#ffc400);color:#111827}
    .btn-white{background:#fff;color:#111827;border:1px solid var(--border)}
    .btn-ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.35)}
    .btn:active{transform:translateY(1px)}

    /* main layout: list + map */
    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:12px;
      margin-bottom:18px;
    }
    @media(max-width:980px){
      .header .wrap{flex-direction:column;align-items:stretch}
      .hero .wrap{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
    }

    .panel{
      background:#fff;border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      display:flex;justify-content:space-between;align-items:center;
      background:linear-gradient(180deg,#fff,#fff8f8);
    }
    .panel-head b{font-size:13px}
    .panel-body{padding:12px 14px}

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:end}
    .field{
      flex:1;min-width:160px;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
    }
    label{display:block;font-size:12px;color:var(--muted);font-weight:900;margin-bottom:6px}
    select,input{
      width:100%;
      border:none;outline:none;background:transparent;
      font-size:13px;font-weight:800;
    }

    /* list */
    .list{
      display:flex;flex-direction:column;gap:8px;
      max-height:60vh; overflow:auto; padding-right:4px;
    }
    .item{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      background:#fff;
      transition:transform .08s ease, box-shadow .12s ease;
    }
    .item:hover{box-shadow:0 8px 18px rgba(0,0,0,.10);transform:translateY(-1px)}
    .item b{display:block;font-size:13px}
    .item small{display:block;color:var(--muted);margin-top:4px;line-height:1.35}

    /* map */
    #map{height:68vh; min-height:460px;}
    .status{
      font-size:12px;color:var(--muted);font-weight:900;
      display:flex;gap:8px;align-items:center;
    }
    .dot{width:9px;height:9px;border-radius:999px;background:#16a34a}
    .dot.bad{background:#ef4444}

    details.console{
      border-top:1px solid var(--border);
      background:#0b1220;color:#e5e7eb;
    }
    details.console summary{
      list-style:none; cursor:pointer;
      padding:10px 14px;
      font-weight:1000;
      display:flex;justify-content:space-between;align-items:center;
      background:rgba(255,255,255,.06);
      user-select:none;
    }
    details.console summary::-webkit-details-marker{display:none}
    .consoleBody{
      padding:12px 14px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New";
      font-size:12px;
      white-space:pre-wrap;
      max-height:220px; overflow:auto;
      border-top:1px solid rgba(255,255,255,.10);
    }

    /* sections show/hide */
    .section{display:none}
    .section.active{display:block}
  </style>
</head>

<body>

<!-- mini menu -->
<div class="top-mini">
  <div class="wrap">
    <a href="#">Gi·ªõi thi·ªáu</a>
    <a href="#">Tin t·ª©c & S·ª± ki·ªán</a>
    <a href="#">Li√™n h·ªá</a>
    <a href="/admin/">Admin</a>
  </div>
</div>

<!-- header -->
<div class="header">
  <div class="wrap">
    <div class="logo">
      <div class="logo-box">CIRCLE K c·ªßa B√© Thu·∫≠n</div>
    </div>

    <div class="menu">
      <div class="tab active" data-tab="system">üè™ H·ªá Th·ªëng Circle K c·ªßa B√© Thu·∫≠n</div>
      <div class="tab" data-tab="gs25">üè™ H·ªá Th·ªëng GS25 c·ªßa B√© Thu·∫≠n</div>
      <div class="tab" data-tab="promo">üéÅ ∆Øu ƒê√£i (demo)</div>
      <div class="tab" data-tab="food">üçî Th·ª©c ƒÇn & Th·ª©c U·ªëng (demo)</div>
    </div>

    <a class="btn btn-ghost" href="/stores/">Stores</a>
  </div>
</div>

<!-- hero -->
<div class="hero">
  <div class="wrap">
    <div>
      <h1>T√åM C·ª¨A H√ÄNG G·∫¶N NH·∫§T</h1>
      <p>Nh·∫≠p ƒë·ªãa ch·ªâ ho·∫∑c t·ªça ƒë·ªô. Ch·ªçn brand ƒë·ªÉ xem danh s√°ch v√† click t·ª´ng ƒëi·ªÉm ƒë·ªÉ m·ªü map.</p>
    </div>

    <div class="hero-card">
      <div class="search">
        <div class="pin">üìç</div>
        <input id="q" placeholder="VD: Nguy·ªÖn Tr√£i, Q5, TP.HCM ho·∫∑c 10.76,106.66" />
        <button class="btn btn-yellow" id="btnSmart">T√¨m</button>
        <button class="btn btn-white" id="btnMyLoc">V·ªã tr√≠ t√¥i</button>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-white" id="btnCopy">Copy JSON</button>
        <button class="btn btn-white" id="btnClear">Clear</button>
      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- ========== SECTION: Circle K system ========== -->
  <div class="section active" id="sec-system">
    <div class="grid">
      <!-- left list -->
      <div class="panel">
        <div class="panel-head">
          <b>Danh s√°ch Circle K</b>
          <div class="status"><span class="dot" id="dot"></span><span id="status">S·∫µn s√†ng.</span></div>
        </div>

        <div class="panel-body">
          <div class="row">
            <div class="field">
              <label>T√¨m trong danh s√°ch</label>
              <input id="filterText" placeholder="G√µ t√™n / ƒë·ªãa ch·ªâ..." />
            </div>
            <div class="field" style="max-width:180px">
              <label>Max_km</label>
              <select id="maxKm">
                <option value="0.2" selected>0.2 km</option>
                <option value="0.5">0.5 km</option>
                <option value="1">1 km</option>
                <option value="2">2 km</option>
                <option value="5">5 km</option>
              </select>
            </div>
          </div>

          <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-yellow" id="btnLoadCK">T·∫£i danh s√°ch Circle K</button>
            <button class="btn btn-white" id="btnLoadNear">S·∫Øp x·∫øp theo g·∫ßn nh·∫•t</button>
          </div>

          <div style="margin-top:12px" class="list" id="storeList">
            <!-- items injected -->
          </div>

          <details class="console" style="margin-top:12px" open>
            <summary><span>JSON Result</span><span style="opacity:.85">thu g·ªçn</span></summary>
            <div class="consoleBody" id="result">{ "result": "K·∫øt qu·∫£ JSON s·∫Ω hi·ªán ·ªü ƒë√¢y..." }</div>
          </details>
        </div>
      </div>

      <!-- right map -->
      <div class="panel">
        <div class="panel-head">
          <b>B·∫£n ƒë·ªì</b>
          <div class="status">Click store ƒë·ªÉ bay t·ªõi ƒëi·ªÉm ‚Ä¢ Click map ƒë·ªÉ l·∫•y t·ªça ƒë·ªô</div>
        </div>
        <div id="map"></div>
      </div>
    </div>
  </div>

  <!-- ========== SECTION: GS25 ========== -->
  <div class="section" id="sec-gs25">
    <div class="panel" style="padding:14px">
      <b>GS25</b>
      <div style="color:var(--muted);margin-top:6px">
        B·∫•m tab ‚ÄúH·ªá Th·ªëng GS25‚Äù ‚Üí m√¨nh d√πng chung map & list, ch·ªâ ƒë·ªïi brand = GS25.
      </div>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-yellow" id="btnLoadGS25">T·∫£i danh s√°ch GS25</button>
      </div>
    </div>
  </div>

  <!-- demo sections -->
  <div class="section" id="sec-promo"><div class="panel" style="padding:14px"><b>∆Øu ƒë√£i</b><div style="color:var(--muted);margin-top:6px">Demo UI.</div></div></div>
  <div class="section" id="sec-food"><div class="panel" style="padding:14px"><b>Th·ª©c ƒÉn & th·ª©c u·ªëng</b><div style="color:var(--muted);margin-top:6px">Demo UI.</div></div></div>
</div>

<script>
  // ===== DOM =====
  const out = document.getElementById('result');
  const statusEl = document.getElementById('status');
  const dot = document.getElementById('dot');

  const qInput = document.getElementById('q');
  const maxKmSel = document.getElementById('maxKm');
  const filterText = document.getElementById('filterText');

  const storeListEl = document.getElementById('storeList');

  // ===== state =====
  let STORES = [];        // all from API
  let STORES_VIEW = [];   // filtered/sorted view
  let currentCenter = null; // {lat, lon}

  // ===== helpers =====
  function setStatus(text, ok=true){
    statusEl.textContent = text || '';
    dot.className = ok ? "dot" : "dot bad";
    statusEl.style.color = ok ? '#16a34a' : '#ef4444';
  }
  function showJSON(obj){ out.textContent = JSON.stringify(obj, null, 2); }
  function esc(s){
    return (s??"").toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function haversineKm(lat1, lon1, lat2, lon2){
    const R = 6371.0;
    const toRad = (x)=> x*Math.PI/180;
    const dlat = toRad(lat2-lat1);
    const dlon = toRad(lon2-lon1);
    const a = Math.sin(dlat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dlon/2)**2;
    return 2*R*Math.asin(Math.sqrt(a));
  }

  async function fetchJSON(url){
    setStatus("ƒêang g·ªçi API...");
    try{
      const res = await fetch(url);
      const data = await res.json();
      showJSON(data);
      if(!res.ok){ setStatus(data.error || "C√≥ l·ªói", false); }
      else{ setStatus(data.message || "OK ‚úÖ", true); }
      return {res, data};
    }catch(e){
      showJSON({error:String(e)});
      setStatus("L·ªói m·∫°ng/Fetch ‚ùå", false);
      return {res:null, data:null};
    }
  }

  // ===== map =====
  const map = L.map("map").setView([10.7769, 106.7009], 12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom:19,
    attribution:"&copy; OpenStreetMap contributors"
  }).addTo(map);

  const userIcon = L.divIcon({
    className:"",
    html:`<div style="width:16px;height:16px;border-radius:999px;background:#2563eb;border:3px solid #fff;box-shadow:0 10px 20px rgba(37,99,235,.35)"></div>`,
    iconSize:[16,16], iconAnchor:[8,8]
  });
  const storeIcon = L.divIcon({
    className:"",
    html:`<div style="width:18px;height:18px;border-radius:6px;background:linear-gradient(180deg,#e31c23,#c3141a);border:2px solid #fff;box-shadow:0 12px 22px rgba(227,28,35,.35)"></div>`,
    iconSize:[18,18], iconAnchor:[9,9]
  });

  let userMarker = null;
  let storeMarkers = []; // for list display

  function clearMarkers(){
    if(userMarker){ userMarker.remove(); userMarker = null; }
    storeMarkers.forEach(m => m.remove());
    storeMarkers = [];
  }

  function setUser(lat, lon, displayAddr=""){
    currentCenter = {lat, lon};
    if(userMarker) userMarker.remove();
    userMarker = L.marker([lat, lon], {icon:userIcon}).addTo(map);
    userMarker.bindPopup(`<b>V·ªã tr√≠</b><br/>${esc(displayAddr || (lat.toFixed(6)+", "+lon.toFixed(6)))}`).openPopup();
    map.setView([lat, lon], 16);
  }

  function focusStore(s){
    map.setView([s.lat, s.lon], 18);
    const popup = `<b>${esc(s.name||"C·ª≠a h√†ng")}</b><br/>${esc(s.address_db||"")}`;
    const m = L.marker([s.lat, s.lon], {icon:storeIcon}).addTo(map).bindPopup(popup).openPopup();
    storeMarkers.push(m);
  }

  // click map => set center (v√† c√≥ th·ªÉ sort g·∫ßn nh·∫•t)
  map.on("click", (e)=>{
    setUser(e.latlng.lat, e.latlng.lng, "Ch·ªçn t·ª´ b·∫£n ƒë·ªì");
  });

  // ===== render list =====
  function renderList(arr){
    storeListEl.innerHTML = "";
    if(!arr.length){
      storeListEl.innerHTML = `<div style="color:#6b7280;font-weight:800">Kh√¥ng c√≥ d·ªØ li·ªáu. B·∫•m ‚ÄúT·∫£i danh s√°ch‚Äù.</div>`;
      return;
    }
    arr.forEach((s)=>{
      const div = document.createElement("div");
      div.className = "item";
      const d = (currentCenter)
        ? haversineKm(currentCenter.lat, currentCenter.lon, s.lat, s.lon).toFixed(2) + " km"
        : "";
      div.innerHTML = `
        <b>${esc(s.name || "Circle K")}</b>
        <small>${esc(s.address_db || "")}</small>
        ${d ? `<small>Kho·∫£ng c√°ch: <b>${esc(d)}</b></small>` : ``}
      `;
      div.onclick = ()=>{
        // m·ªói l·∫ßn click store => clear marker store c≈© ƒë·ªÉ ƒë·ª° r·ªëi
        storeMarkers.forEach(m => m.remove());
        storeMarkers = [];
        focusStore(s);
      };
      storeListEl.appendChild(div);
    });
  }

  function applyFilter(){
    const t = (filterText.value || "").trim().toLowerCase();
    STORES_VIEW = STORES.filter(s=>{
      const hay = ((s.name||"")+" "+(s.address_db||"")).toLowerCase();
      return !t || hay.includes(t);
    });
    renderList(STORES_VIEW);
  }

  function sortByNearest(){
    if(!currentCenter){
      setStatus("Ch∆∞a c√≥ ƒëi·ªÉm trung t√¢m. H√£y T√¨m ho·∫∑c click b·∫£n ƒë·ªì tr∆∞·ªõc.", false);
      return;
    }
    STORES_VIEW = [...STORES_VIEW].sort((a,b)=>{
      const da = haversineKm(currentCenter.lat, currentCenter.lon, a.lat, a.lon);
      const db = haversineKm(currentCenter.lat, currentCenter.lon, b.lat, b.lon);
      return da - db;
    });
    renderList(STORES_VIEW);
    setStatus("ƒê√£ s·∫Øp x·∫øp theo g·∫ßn nh·∫•t ‚úÖ", true);
  }

  // ===== load stores =====
  async function loadBrand(brand){
    // d√πng API b·∫°n ƒë√£ c√≥
    const {res, data} = await fetchJSON(`/tools/stores-by-brand/?brand=${encodeURIComponent(brand)}`);
    if(!res || !res.ok) return;

    STORES = (data.stores || []).map(x=>({
      id:x.id,
      name:x.name,
      brand:x.brand,
      address_db:x.address_db || "",
      lat:Number(x.lat),
      lon:Number(x.lon),
    }));
    // rename lon -> lon but we keep lon; focusStore uses s.lon? -> uses s.lon; map uses s.lon
    // convert to s.lon, but earlier focusStore uses s.lon; we stored lon. We'll normalize:
    STORES = STORES.map(s=>({ ...s, lon:s.lon, lon_:s.lon })); // keep safe

    // fix property names for map
    STORES = STORES.map(s=>({ ...s, lon:s.lon, lon:s.lon, lon_ok:s.lon, lon2:s.lon, lonFinal:s.lon })); // no-op

    // Actually simplest: unify to s.lon; already have.
    // But API returns "lon" field, we stored as lon.

    STORES_VIEW = [...STORES];
    applyFilter();
    setStatus(`ƒê√£ t·∫£i ${STORES.length} c·ª≠a h√†ng (${brand}) ‚úÖ`, true);
  }

  // ===== smart search (ƒë·ªÉ c√≥ center) =====
  async function callSmart(){
    const q = (qInput.value || "").trim();
    if(!q){ setStatus("Nh·∫≠p ƒë·ªãa ch·ªâ ho·∫∑c lat,lon.", false); return; }

    const maxKm = maxKmSel.value;
    // m·∫∑c ƒë·ªãnh center theo CircleK (tab system), b·∫°n c√≥ th·ªÉ ƒë·ªïi theo tab
    const brand = document.querySelector('.tab.active')?.dataset?.tab === "gs25" ? "GS25" : "CIRCLEK";

    const {res, data} = await fetchJSON(`/tools/smart-search/?q=${encodeURIComponent(q)}&brand=${encodeURIComponent(brand)}&max_km=${encodeURIComponent(maxKm)}`);
    if(!res || !res.ok || !data.location) return;

    setUser(Number(data.location.lat), Number(data.location.lon), data.location.display_address || q);
    // n·∫øu c√≥ store nearest -> focus lu√¥n
    if(data.store){
      storeMarkers.forEach(m => m.remove());
      storeMarkers = [];
      focusStore({lat:Number(data.store.lat), lon:Number(data.store.lon), name:data.store.name, address_db:data.store.address_db || ""});
    }
  }

  // ===== tabs switch =====
  function setActiveTab(name){
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelector(`.tab[data-tab="${name}"]`)?.classList.add("active");

    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    const sec = document.getElementById(`sec-${name}`) || document.getElementById("sec-system");
    sec.classList.add("active");

    // khi chuy·ªÉn tab, n·∫øu l√† gs25 th√¨ t·ª± load list gs25 (n·∫øu mu·ªën)
    if(name === "gs25"){
      // optional: auto load
      // loadBrand("GS25");
    }
  }

  document.querySelectorAll(".tab").forEach(t=>{
    t.onclick = ()=> setActiveTab(t.dataset.tab);
  });

  // ===== buttons =====
  document.getElementById("btnSmart").onclick = callSmart;

  document.getElementById("btnMyLoc").onclick = ()=>{
    if(!navigator.geolocation){
      setStatus("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ geolocation.", false);
      return;
    }
    setStatus("ƒêang l·∫•y v·ªã tr√≠...");
    navigator.geolocation.getCurrentPosition(
      (pos)=>{
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        qInput.value = `${lat},${lon}`;
        callSmart();
      },
      ()=> setStatus("Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠. H√£y c·∫•p quy·ªÅn Location.", false),
      {enableHighAccuracy:true, timeout:8000}
    );
  };

  document.getElementById("btnCopy").onclick = async ()=>{
    try{ await navigator.clipboard.writeText(out.textContent); setStatus("ƒê√£ copy JSON ‚úÖ", true); }
    catch{ setStatus("Kh√¥ng copy ƒë∆∞·ª£c (tr√¨nh duy·ªát ch·∫∑n).", false); }
  };

  document.getElementById("btnClear").onclick = ()=>{
    qInput.value = "";
    filterText.value = "";
    STORES = []; STORES_VIEW = [];
    currentCenter = null;
    clearMarkers();
    renderList([]);
    showJSON({result:"K·∫øt qu·∫£ JSON s·∫Ω hi·ªán ·ªü ƒë√¢y..."});
    map.setView([10.7769, 106.7009], 12);
    setStatus("ƒê√£ clear.", true);
  };

  document.getElementById("btnLoadCK").onclick = ()=> loadBrand("CIRCLEK");
  document.getElementById("btnLoadGS25").onclick = ()=> { setActiveTab("gs25"); loadBrand("GS25"); };

  document.getElementById("btnLoadNear").onclick = ()=>{
    applyFilter();
    sortByNearest();
  };

  filterText.addEventListener("input", ()=>{
    applyFilter();
  });

  // ===== initial =====
  renderList([]);
  showJSON({result:"K·∫øt qu·∫£ JSON s·∫Ω hi·ªán ·ªü ƒë√¢y..."});
  setStatus("S·∫µn s√†ng.", true);
</script>

</body>
</html>
